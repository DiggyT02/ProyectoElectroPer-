<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
  <title>Document</title>
</head>
<body>
  <h1>Tiendas</h1>

  <form action="" method="post" id="form-tiendas" autocomplete="off">

        <input type="hidden" id="id">

        <div class="card">
          <div class="card-header">
            <strong>Complete los datos solicitados</strong>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control rounded-0"
                    id="tienda"
                    required
                    autofocus
                  />
                  <label for="descripcion">Tienda</label>
                </div>
              </div>
            </div>
            <div class="card-footer text-end">
            <button type="reset" class="btn rounded-0 btn-outline-secondary" id="btnCancelar">
              Cancelar
            </button>
            <button type="submit" class="btn rounded-0 btn-primary" id="btnGuardar">
              Guardar
            </button>
          </div>
        </div>
            </div>
          </div>
  </form>
    
  
  <div class="table-resposive mt-3">
        <table class="table table-bordered" id="tabla-tiendas">
          <colgroup>
            <col style="width: 10%;">
            <col style="width: 60%;">
            <col style="width: 30%;">
          </colgroup>
          <thead>
            <tr>
              <th class="text-center">ID</th>
              <th>Tienda</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
           
          </tbody>
        </table>
      </div>
        
  <script>
    const API_URL = 'http://localhost:3000/api/tiendas'
    
    const tabla = document.querySelector("#tabla-tiendas tbody")
    const formulario = document.querySelector("#form-tiendas")
    const tienda = document.getElementById('tienda')

    async function obtenerTiendas(){
    const response = await fetch(API_URL, { method: 'get' })
    const tiendas = await response.json()
      //console.log(tiendas)

      tabla.innerHTML = ''

      tiendas.forEach(item => {
        const row = tabla.insertRow() //<tr></tr>
        row.insertCell().textContent = item.id //<td></td>
        row.insertCell().textContent = item.tienda //<td></td>

        const actionCell = row.insertCell()

        const editButton = document.createElement("button")
        editButton.textContent = 'Editar'
        editButton.classList.add('btn', 'btn-sm', 'btn-dark')
        editButton.onclick = () => cargarParaEdicion(item)

        const deleteButton = document.createElement("button")
        deleteButton.textContent = 'Eliminar'
        deleteButton.classList.add('btn', 'btn-sm', 'btn-danger')
        deleteButton.onclick = () => eliminarTienda(item.id, item.tienda)

        actionCell.appendChild(editButton)
        actionCell.appendChild(deleteButton)
      });
      
  }


    formulario.addEventListener("submit", async(event) => {
      event.preventDefault()

      const data = {tienda: tienda.value}

      try{
        const response = await fetch(API_URL, {
          method: 'post',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data)
        })
        const result = await response.json()
        formulario.reset()
        obtenerTiendas()
        console.log(result)
      }catch(e){
        console.error(e)
      }
    })
    document.addEventListener('DOMContentLoaded', obtenerTiendas)
   
  </script>
</body>
</html>