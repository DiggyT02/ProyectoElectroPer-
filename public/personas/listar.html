<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</head>
<body>

    <main class="container">
      <div class="row">
        <div class="col-md-12">
          <h3>Lista de personas</h3>
          <a href="#">Registrar</a>
          <a href="http:http://localhost:3000/personas/clientes.html"></a>
        </div>
      </div>


      <style>
         td:nth-child(6),
         td:nth-child(7){
          text-align: center;
      }
      </style>

      <div class="row">
        <div class="col-md-12">
          <div class="table-responsive">
            <table id="tabla-personas" class="table table-striped table-bordered table-sm">
              <colgroup>
              <col style="width: 5">
              <col style="width: 25;">
              <col style="width: 25;">
              <col style="width: 10;">
              <col style="width: 10;">
              <col style="width: 10;">
              <col style="width: 15;">
              </colgroup>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Apellidos</th>
                  <th>Nombres</th>
                  <th>DNI</th>
                  <th>Teléfono</th>
                  <th>Fotografía</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
               <!-- Asíncrono -->
              </tbody>
            </table>
          </div>
        </div> <!-- ./col-md-12 -->
      </div> <!--  ./row -->
    </main>

    <script>
      const API_URL = 'http://localhost:3000/api/personas'
      const datosTabla = document.querySelector("#tabla-personas tbody")

      async function obtenerDatos() {
        const response = await fetch(API_URL, {method: 'get'})
        //console.log(response)

        if (!response.ok){
          console.error("Problemas con la conexión")
          return;
        }
        const personas = await response.json()

        if (personas.length === 0){
          console.log("No hay personas registradas")

         const fila = document.createElement("tr")
         const celda = document.createElement("td")

          celda.colSpan = 7
          celda.textContent = 'No hay personas registradas'
          celda.classList.add('text-center')

          fila.appendChild(celda)
          datosTabla.appendChild(fila)

          return;
        }

        //Renderizar los datos en el cuerpo de la tabla
        console.log(personas)
        personas.forEach(persona => {
          const row = datosTabla.insertRow() //<tr></tr>
          

          row.insertCell().textContent = persona.id
          row.insertCell().textContent = persona.apellidos
          row.insertCell().textContent = persona.nombres
          row.insertCell().textContent = persona.dni
          row.insertCell().textContent = persona.telefono

          //El campo foto se gestionará a través de un enlace
          const fotoCell = row.insertCell()//<td></td>
          const fotoLnk  = document.createElement("a")//<a></a>
          fotoLnk.href = persona.fotografia //<a href='..'></a>
          fotoLnk.textContent = 'Ver foto' //<a href='...'>texto</a>
          fotoLnk.classList.add('btn', 'btn-sm', 'btn-info')
          fotoCell.appendChild(fotoLnk)

          const actionCell= row.insertCell()//<td></td>
          //Eliminar => botóm (JS) => fetch() (asíncrono)
          const btnEliminar = document.createElement("button")
          btnEliminar.textContent = 'Eliminar'
          btnEliminar.classList.add('btn', 'btn-sm', 'btn-danger')
          btnEliminar.onclick = () => eliminarPersona(persona)


          //Editar => será un enlace => se realizará en otra vista
          const editLnk = document.createElement("a")
          editLnk.href = `#`
          editLnk.textContent = 'Editar'
          editLnk.classList.add('btn', 'btn-sm', 'btn-warning')


          //Agregamos el botón y enlace a la nueva celda
          actionCell.appendChild(btnEliminar)
          actionCell.appendChild(editLnk)
          
        });
      }

      async function eliminarPersona(persona) {
        if (confirm(`¿Está seguro de eliminar el registro de ${persona.nombres} ${persona.apellidos}`)){
       //...
      }
    }
        document.addEventListener("DOMContentLoaded", obtenerDatos)
    </script>
</body>
</html>